# 脚本修改记录

## 问题诊断
脚本在运行时出现 `ValueError: all the input array dimensions except for the concatenation axis must match exactly` 错误。

### 根本原因
FASTA文件中不同位点对不同样本存在缺失值（标记为255），导致在提取多态位点时，每个位点有效样本数不同：
- 位点1可能有1068个有效样本
- 位点2可能有1070个有效样本  
- 位点3可能有1067个有效样本

当这些大小不同的数组被np.vstack()拼接时就会报错。

## 修改内容

### 1. 删除注释代码
- 移除所有被注释掉的旧代码（#开头的行）
- 保持代码简洁易维护

### 2. 添加输入文件验证功能
在main()函数执行前，增加了两个验证函数：

#### `validate_csv_file(csv_path)`
检查CSV文件的格式和内容：
- 检查文件是否存在
- 检查是否包含必需的 'ID' 和 'Haplogroup' 列
- 检查ID和Haplogroup中是否包含禁止字符：`-`, `.`, `\n`, `\r`, `\t`
- 如果有问题，立即终止程序并提示用户

#### `validate_fasta_files(fasta_dir)`
检查所有FASTA文件的格式和内容：
- 检查所有必需的FASTA文件是否存在
- 逐行检查序列，确保只包含 A/C/G/T（大小写）
- 检查不存在缺失标记 `-`, `.`, `N` 等无效字符
- 检查所有序列等长
- 如果有问题，立即终止程序并详细提示用户

### 3. 改进错误提示
验证失败时，会显示：
```
============================================================
❌ 输入文件验证失败
============================================================
[具体错误信息，包括文件名、行号、问题类型]
============================================================
```

## 使用方法

运行脚本时，它会自动验证所有输入文件。如果文件格式不正确，会立即告诉您：
- 哪个文件有问题
- 具体是什么问题
- 如何修复

例如：
```
[2025-11-07 18:00:00] ERROR: 
============================================================
❌ 输入文件验证失败
============================================================
/path/to/data.fasta 序列 'AP008265' 中包含无效字符 '-'（ASCII: 45）
序列只允许包含 A/C/G/T
请检查是否包含缺失标记 -, ., N 或其他字符
请格式化FASTA文件后重新运行
============================================================
```

## 建议

如果遇到FASTA文件验证失败，可以使用以下命令清理FASTA文件：

```bash
# 移除所有非ACGT字符（保留ACGT和>）
sed 's/[^ACGT>]//g' input.fasta > output.fasta

# 或者如果有小写字母，先转换为大写
sed 's/[^ACGT]//gI; /^>/!s/./\U&/g' input.fasta > output.fasta
```

